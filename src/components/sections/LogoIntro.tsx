"use client";

import { useEffect, useRef, useState } from "react";

interface LogoIntroProps {
  onComplete: () => void;
}

/* Animation timings (ms) */
const DRAW_DURATION = 2000;
const FILL_AT = 2000;
const FILL_DURATION = 500;
const SHRINK_AT = 2500;
const SHRINK_DURATION = 1000;
const FADE_AT = 3500;
const FADE_DURATION = 500;
const DONE_AT = 4000;

const LOGO_PATH =
  "M316.251 2.80274C323.21 6.35374 323.946 7.89574 324.357 19.7747C324.752 31.2007 323.521 47.1537 320.335 71.9227C317.129 96.8377 316.539 101.114 315.503 106.923C314.963 109.948 314.091 115.348 313.564 118.923C312.293 127.543 306.138 163.418 302.497 183.423C300.895 192.223 297.505 211.123 294.964 225.423C292.423 239.723 290.096 252.548 289.792 253.923C288.811 258.369 292.008 254.087 294.272 247.923C295.383 244.898 298.137 238.459 300.391 233.614C302.645 228.769 304.489 224.633 304.489 224.422C304.489 223.151 328.435 174.439 335.704 160.923C337.627 157.348 341.13 150.823 343.49 146.423C345.85 142.023 348.615 137.229 349.635 135.769C350.655 134.309 351.489 132.894 351.489 132.624C351.489 132.145 354.46 127.022 374.804 92.4227C384.836 75.3617 394.978 59.2097 407.575 40.2307C411.296 34.6247 415.108 28.4217 416.045 26.4457C418.355 21.5777 420.637 20.5807 428.092 21.1787C435.698 21.7897 440.61 24.5517 442.983 29.5517C444.61 32.9807 444.597 33.5297 442.687 41.2857C441.585 45.7607 438.563 56.8477 435.972 65.9227C430.899 83.6897 425.973 101.986 424.529 108.423C424.035 110.623 422.257 118.048 420.577 124.923C409.909 168.588 406.471 185.117 399.985 223.923C397.285 240.076 393.521 275.812 393.501 285.473C393.494 288.829 392.955 292.057 392.289 292.723C391.479 293.533 386.878 293.923 378.14 293.923H365.191L365.901 275.173C367.024 245.548 369.434 229.634 380.019 181.923C388.158 145.24 393.244 127.118 408.175 81.5857C412.835 67.3747 416.426 55.5267 416.155 55.2557C414.462 53.5627 393.278 85.5017 374.922 117.423C362.68 138.712 336.153 189.786 331.034 201.923C329.99 204.398 327.629 209.734 325.789 213.78C318.255 230.341 303.929 268.423 299.402 283.923C298.197 288.048 296.802 291.945 296.302 292.583C295.145 294.06 261.356 294.326 260.453 292.865C260.119 292.324 260.465 287.278 261.224 281.652C263.088 267.817 262.397 250.439 259.644 241.923C256.711 232.854 251.161 223.888 243.167 215.305C236.179 207.803 224.526 197.923 222.665 197.923C222.092 197.923 221.304 198.935 220.914 200.173C220.075 202.832 211.342 223.68 204.263 239.923C198.154 253.94 181.232 288.706 179.25 291.311C178.073 292.858 176.337 293.234 169.651 293.39C165.162 293.494 161.489 293.162 161.489 292.652C161.489 291.76 167.944 279.477 169.492 277.423C174.836 270.331 210.485 194.162 210.488 189.825C210.489 189.497 205.652 186.73 199.739 183.678C172.62 169.679 144.463 162.923 113.239 162.923C67.3681 162.923 26.2511 184.359 9.97912 216.756C8.52012 219.66 6.80114 221.878 6.15814 221.684C5.51514 221.491 3.89413 219.145 2.55713 216.47C-0.957874 209.442 -0.834868 198.15 2.83813 190.643C14.2431 167.331 61.7741 146.923 104.663 146.923C114.489 146.923 138.148 150.261 150.842 153.439C171.336 158.569 180.577 162.056 200.772 172.28C208.913 176.401 214.903 178.882 215.405 178.34C215.873 177.836 218.512 172.248 221.268 165.923C233.917 136.898 244.733 112.162 245.972 109.423C246.718 107.773 248.992 102.598 251.026 97.9227C266.513 62.3187 294.131 6.18974 298.131 2.18974C300.452 -0.131264 301.161 -0.292265 306.589 0.275735C309.848 0.615735 314.196 1.75274 316.251 2.80274ZM288.671 48.1897C281.152 62.2727 272.277 81.0957 260.505 107.923C256.522 116.998 251.517 128.357 249.381 133.166C247.245 137.974 242.521 148.999 238.884 157.666C235.247 166.332 230.991 176.472 229.426 180.198L226.582 186.973L234.285 193.134C245.154 201.824 257.482 214.639 263.091 223.076C265.721 227.033 268.004 229.854 268.163 229.347C268.322 228.839 270.064 217.398 272.034 203.923C276.311 174.656 276.236 175.149 281.374 142.923C283.611 128.898 285.939 114.048 286.548 109.923C287.157 105.798 288.048 100.173 288.527 97.4227C289.298 93.0007 290.502 84.3847 295.766 45.6107C296.498 40.2147 296.791 35.6097 296.416 35.3777C296.042 35.1457 292.556 40.9117 288.671 48.1897ZM279.739 301.613C280.722 302.174 280.714 306.923 279.73 306.923C279.312 306.923 278.408 306.023 277.721 304.923C276.227 302.53 272.248 302.307 270.06 304.494C269.196 305.359 268.489 306.288 268.489 306.56C268.489 308.274 271.11 311.181 275.495 314.332C281.744 318.821 283.245 321.683 281.528 325.829C279.525 330.665 275.927 332.341 268.207 332.034C265.16 331.912 263.399 328.982 264.301 325.534C264.797 323.637 264.841 323.642 265.595 325.681C267.103 329.758 272.485 331.141 275.66 328.268C278.495 325.702 277.855 323.328 273.355 319.729C265.866 313.739 264.489 312.102 264.489 309.191C264.489 305.815 266.89 302.107 269.846 300.917C271.793 300.133 277.896 300.562 279.739 301.613ZM91.0421 312.114L96.7661 323.304L99.5191 317.86C110.354 296.432 111.213 296.203 111.703 314.614C111.905 322.209 112.438 329.211 112.887 330.173C113.589 331.679 113.163 331.923 109.839 331.923H105.974L106.328 324.129C106.945 310.538 106.498 310.278 101.241 321.173C98.6531 326.535 96.1881 330.921 95.7621 330.919C95.3371 330.917 92.9781 326.632 90.5191 321.397C86.6041 313.062 85.9421 312.162 85.1911 314.152C84.7181 315.401 84.4831 319.91 84.6681 324.173L85.0042 331.923H82.2461C79.4061 331.923 78.7771 331.035 80.4411 329.371C80.9641 328.848 81.5271 322.235 81.6911 314.677C82.0781 296.81 83.0741 296.537 91.0421 312.114ZM145.395 303.856C151.593 308.27 153.133 316.293 149.239 323.887C143.833 334.43 127.708 334.891 121.484 324.682C117.192 317.643 119.683 307.282 126.73 302.86C131.271 300.01 140.7 300.513 145.395 303.856ZM169.739 301.912C175.375 301.947 177.496 311.159 172.858 315.457L170.227 317.895L174.437 323.471C176.753 326.537 179.286 329.292 180.068 329.592C182.283 330.442 181.738 331.923 179.212 331.923C176.072 331.923 173.058 329.61 169.546 324.505C167.908 322.125 165.65 319.937 164.528 319.644C162.662 319.155 162.489 319.568 162.489 324.517C162.489 327.49 162.939 329.923 163.489 329.923C164.039 329.923 164.489 330.373 164.489 330.923C164.489 331.473 162.716 331.923 160.548 331.923C158.38 331.923 156.329 331.473 155.989 330.923C155.649 330.373 155.848 329.923 156.43 329.923C158.042 329.923 157.859 304.274 156.239 303.253C154.493 302.153 160.056 300.962 164.489 301.487C166.414 301.715 168.777 301.906 169.739 301.912ZM241.489 313.487C241.489 308.704 241.023 303.921 240.454 302.857C239.518 301.109 239.77 300.923 243.061 300.923C246.185 300.923 246.583 301.172 245.858 302.673C245.394 303.635 244.862 310.723 244.677 318.423L244.34 332.423L233.945 321.423L223.549 310.423L223.519 319.614C223.503 324.697 223.936 329.081 224.489 329.423C226.446 330.632 225.444 331.923 222.548 331.923C219.472 331.923 217.728 330.511 219.473 329.433C220.08 329.058 220.508 323.096 220.535 314.614L220.582 300.423L231.035 311.302L241.489 322.182V313.487ZM293.923 301.821C295.252 302.341 295.486 302.807 294.673 303.31C293.11 304.275 293.082 322.282 294.639 325.239C296.222 328.247 297.432 328.892 301.489 328.892C305.546 328.892 306.756 328.247 308.339 325.239C309.764 322.532 309.876 304.28 308.473 303.413C306.728 302.335 308.472 300.923 311.548 300.923C314.444 300.923 315.446 302.214 313.489 303.423C312.932 303.768 312.489 308.412 312.489 313.917C312.489 319.349 312.058 324.926 311.532 326.31C310.26 329.656 305.624 331.923 300.054 331.923C296.459 331.923 294.845 331.319 292.255 329.007C289 326.1 288.988 326.055 288.646 315.257C288.457 309.298 287.898 303.932 287.404 303.331C285.577 301.109 289.679 300.159 293.923 301.821ZM341.218 302.887C346.559 305.311 349.48 309.924 349.485 315.939C349.494 326.31 342.504 331.924 329.582 331.922H321.989V316.422V300.922L329.489 300.944C334.71 300.96 338.274 301.55 341.218 302.887ZM372.785 303.774C375.687 306.677 375.582 312.131 372.56 315.347L370.232 317.826L374.01 323.124C376.088 326.039 378.396 328.783 379.139 329.223C381.112 330.391 380.787 331.923 378.566 331.923C376.021 331.923 370.892 327.522 367.884 322.756C364.354 317.164 362.489 317.671 362.489 324.223C362.489 327.138 363.029 330.063 363.689 330.723C364.622 331.656 363.821 331.923 360.082 331.923C355.852 331.923 355.375 331.713 356.11 330.173C357.379 327.513 357.765 306.307 356.584 304.1C355.031 301.199 356.354 300.668 363.835 301.191C369.034 301.554 371.186 302.176 372.785 303.774ZM390.989 301.923C390.363 302.936 396.255 314.924 397.378 314.922C398.483 314.92 403.489 305.175 403.489 303.026C403.489 301.289 404.099 300.923 406.989 300.923C410.956 300.923 411.359 301.825 408.536 304.381C407.461 305.353 404.761 309.163 402.536 312.846C399.402 318.032 398.489 320.556 398.489 324.033C398.489 326.503 399.014 329.048 399.656 329.69C401.099 331.133 398.785 332.249 395.382 331.752C393.267 331.443 393.144 331.003 393.38 324.602C393.62 318.106 393.435 317.479 389.478 311.407C387.194 307.9 384.687 304.502 383.907 303.855C381.426 301.796 382.361 300.923 387.048 300.923C389.832 300.923 391.366 301.312 390.989 301.923ZM434.086 307.173L433.989 313.423L441.239 313.717L448.489 314.011V309.401C448.489 306.866 448.023 303.921 447.454 302.857C446.498 301.071 446.782 300.923 451.154 300.923C454.837 300.923 455.622 301.19 454.689 302.123C452.959 303.853 453.005 329.872 454.739 330.055C455.427 330.127 454.414 330.487 452.489 330.854C448.178 331.677 445.903 331.109 447.422 329.59C448.009 329.003 448.489 325.913 448.489 322.723V316.923H440.989H433.489V322.864C433.489 326.132 433.939 329.083 434.489 329.423C436.679 330.776 435.293 332.027 431.929 331.733L428.368 331.423L428.179 316.173L427.989 300.923H431.086H434.182L434.086 307.173ZM480.489 303.423C480.489 305.948 479.128 306.765 477.989 304.923C477.649 304.373 475.598 303.923 473.43 303.923H469.489V309.05V314.177L474.489 313.697C479.176 313.247 479.489 313.36 479.489 315.511C479.489 318.051 477.979 319.524 476.999 317.939C476.654 317.38 474.8 316.923 472.88 316.923H469.389L469.689 322.673L469.989 328.423L474.333 328.735C477.607 328.97 479.016 328.601 480.052 327.235C481.328 325.551 481.428 325.61 481.457 328.066C481.496 331.289 480.036 331.927 472.657 331.909C464.948 331.891 462.11 331.085 463.567 329.329C464.312 328.431 464.57 323.454 464.338 314.451L463.989 300.922H472.239C480.372 300.923 480.489 300.958 480.489 303.423ZM510.489 312.752C510.489 306.752 510.053 302.887 509.289 302.123C508.356 301.19 508.919 300.923 511.824 300.923C515.207 300.923 515.462 301.105 514.524 302.857C513.955 303.921 513.467 311.009 513.441 318.607L513.392 332.423L502.941 321.443L492.489 310.462V320.193C492.489 326.374 492.875 329.923 493.548 329.923C494.13 329.923 494.329 330.373 493.989 330.923C493.649 331.473 491.999 331.923 490.323 331.923C487.786 331.923 487.407 331.63 488.064 330.173C488.498 329.211 489.047 322.123 489.284 314.423L489.715 300.423L500.102 311.302L510.489 322.182V312.752ZM206.174 315.482C209.107 322.599 212.178 328.923 212.998 329.533C215.295 331.244 214.791 331.924 211.239 331.908C207.41 331.89 206.106 331.103 205.666 328.546C204.676 322.79 203.744 321.923 198.549 321.923C193.123 321.923 191.947 322.978 191.218 328.5C190.91 330.835 190.273 331.489 188.052 331.75C186.522 331.93 185.446 331.705 185.66 331.25C190.42 321.132 191.897 317.842 192.99 314.923C195.942 307.035 198.699 301.826 199.738 302.173C200.344 302.375 203.241 308.364 206.174 315.482ZM130.797 303.886C123.795 306.855 123.174 322.267 129.834 327.794C134.867 331.972 143.86 328.794 145.057 322.415C146.238 316.118 145.033 309.012 142.323 306.303C139.618 303.597 134.172 302.455 130.797 303.886ZM162.489 309.954C162.489 316.806 163.879 318.208 167.997 315.51C172.796 312.365 170.365 303.923 164.66 303.923C162.672 303.923 162.489 304.431 162.489 309.954ZM327.707 316.043L327.989 328.423L332.625 328.723C336.374 328.966 337.809 328.552 340.125 326.56C342.774 324.281 342.989 323.566 342.989 317.032C342.989 310.717 342.707 309.687 340.328 307.307C338.355 305.334 336.343 304.519 332.546 304.154L327.425 303.662L327.707 316.043ZM362.489 309.923C362.489 316.02 362.505 316.054 365.232 315.739C367.062 315.528 368.411 314.508 369.286 312.673C371.112 308.846 369.078 304.55 365.232 304.107C362.505 303.792 362.489 303.826 362.489 309.923ZM197.015 312.873C194.583 317.575 195.01 318.923 198.928 318.923H202.368L200.834 314.423C199.991 311.948 199.13 309.923 198.921 309.923C198.712 309.923 197.854 311.251 197.015 312.873ZM137.466 351.205C114.281 373.778 91.3001 384.941 68.0791 384.911C55.2191 384.894 44.8131 381.709 38.6731 375.91C35.4791 372.893 36.4541 372.486 42.1441 374.461C49.4211 376.987 67.2821 377.532 75.9891 375.494C91.0901 371.959 108.457 361.292 121.989 347.241L128.989 339.972L138.989 339.979L148.989 339.986L137.466 351.205Z";

export default function LogoIntro({ onComplete }: LogoIntroProps) {
  const pathRef = useRef<SVGPathElement>(null);
  const svgRef = useRef<SVGSVGElement>(null);
  const onCompleteRef = useRef(onComplete);
  onCompleteRef.current = onComplete;

  const [phase, setPhase] = useState<
    "draw" | "fill" | "shrink" | "fade" | "done"
  >("draw");

  useEffect(() => {
    const path = pathRef.current;
    if (!path) return;

    /* ── Phase 1: stroke draw ── */
    const len = path.getTotalLength();
    path.style.strokeDasharray = `${len}`;
    path.style.strokeDashoffset = `${len}`;

    requestAnimationFrame(() => {
      requestAnimationFrame(() => {
        if (!pathRef.current) return;
        pathRef.current.style.transition = `stroke-dashoffset ${DRAW_DURATION}ms ease-in-out`;
        pathRef.current.style.strokeDashoffset = "0";
      });
    });

    /* ── Phase 2: fill white ── */
    const t1 = setTimeout(() => setPhase("fill"), FILL_AT);

    /* ── Phase 3: shrink to header logo position ── */
    const t2 = setTimeout(() => {
      const svg = svgRef.current;
      const target = document.querySelector("[data-logo-target]");

      if (svg && target) {
        const svgRect = svg.getBoundingClientRect();
        const targetRect = target.getBoundingClientRect();

        /* Scale so SVG height matches header logo text height */
        const s = targetRect.height / svgRect.height;

        /* Translate SVG center to target center */
        const tx =
          targetRect.left +
          targetRect.width / 2 -
          (svgRect.left + svgRect.width / 2);
        const ty =
          targetRect.top +
          targetRect.height / 2 -
          (svgRect.top + svgRect.height / 2);

        /* Apply via DOM for reliable CSS transition */
        svg.style.transition = `transform ${SHRINK_DURATION}ms cubic-bezier(0.4, 0, 0.2, 1)`;
        /* Force reflow so transition property registers before transform changes */
        svg.getBoundingClientRect();
        svg.style.transform = `translate(${tx}px, ${ty}px) scale(${s})`;
      }

      setPhase("shrink");
    }, SHRINK_AT);

    /* ── Phase 4: fade overlay ── */
    const t3 = setTimeout(() => setPhase("fade"), FADE_AT);

    /* ── Done: unmount & trigger hero ── */
    const t4 = setTimeout(() => {
      setPhase("done");
      window.dispatchEvent(new Event("logo-intro-done"));
      onCompleteRef.current();
    }, DONE_AT);

    return () => {
      clearTimeout(t1);
      clearTimeout(t2);
      clearTimeout(t3);
      clearTimeout(t4);
    };
  }, []);

  if (phase === "done") return null;

  const isFilled = phase !== "draw";

  return (
    <div
      className="fixed inset-0 z-[2000] flex items-center justify-center"
      style={{
        background:
          "radial-gradient(ellipse at 30% 20%, #004466 0%, #003149 40%, #001e2d 100%)",
        opacity: phase === "fade" ? 0 : 1,
        transition:
          phase === "fade" ? `opacity ${FADE_DURATION}ms ease` : "none",
        pointerEvents: "none",
      }}
    >
      <svg
        ref={svgRef}
        viewBox="0 0 515 385"
        className="w-[60vw] max-w-[500px]"
      >
        <path
          ref={pathRef}
          fillRule="evenodd"
          clipRule="evenodd"
          d={LOGO_PATH}
          fill="white"
          stroke="white"
          strokeWidth="1"
          style={{
            fillOpacity: isFilled ? 1 : 0,
            strokeOpacity: isFilled ? 0 : 1,
            transition: `fill-opacity ${FILL_DURATION}ms ease, stroke-opacity ${FILL_DURATION}ms ease`,
          }}
        />
      </svg>
    </div>
  );
}
